<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trivia Game</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .game-container {
      max-width: 700px;
      margin: 2rem auto;
      padding: 2rem;
      background-color: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      text-align: center;
    }

    #question {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: #1e293b;
    }

    #options {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin: 1rem 0;
    }

    .option-btn {
      display: block;
      width: 100%;
      background-color: #2c96ee; 
      color: white;
      border: none;
      padding: 12px;
      margin: 10px 0;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.1s;
    }

    .option-btn:hover:not(:disabled) {
      background-color: #2b73e6; 
      transform: scale(1.02);
    }

    .option-btn:disabled {
      cursor: not-allowed;
      opacity: 0.7;
    }

    #score-tally,
    #high-score-display,
    #timer {
      margin: 0.5rem 0;
      font-weight: bold;
      font-size: 1rem;
      color: #334155;
    }

    #result p {
      font-size: 1.25rem;
    }

    #back-to-home-btn {
      margin-top: 1rem;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      background-color: #0ea5e9;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    #back-to-home-btn:hover {
      background-color: #0284c7;
    }
  </style>
</head>
<body>
  <div class="game-container" id="question-container">
    <h2 id="question">Loading question...</h2> <!-- question text -->
    <div id="options"></div> <!-- where all the answer buttons will go -->
    <div id="timer"></div> <!-- timer countdown -->
    <div id="high-score-display">High Score: 0</div> <!-- high score section -->
    <div id="score-tally">Correct: 0 / Total: 0</div> <!-- score section -->
  </div>

  <div class="game-container" id="result" style="display: none;">
    <h2>Game Over!</h2>
    <p>Your score: <span id="final-score"></span></p> <!-- final score display -->
    <button id="back-to-home-btn">Back to Home</button> <!-- button to restart game -->
  </div>

  <script type="module">
    import questionBank from './questions.js'; //grabbed the question bank

    const params = new URLSearchParams(window.location.search); 
    const category = params.get('category'); //getting the category
    const difficulty = params.get('difficulty'); //getting the difficulty
    const timerDuration = parseInt(params.get('timer')); //getting timer length

    const questionContainer = document.getElementById('question-container');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const timerEl = document.getElementById('timer');
    const resultEl = document.getElementById('result');
    const scoreTallyEl = document.getElementById('score-tally');
    const finalScoreEl = document.getElementById('final-score');
    const backToHomeBtn = document.getElementById('back-to-home-btn');
    const highScoreDisplay = document.getElementById('high-score-display');

    let currentQuestionIndex = 0; //index starts at 0
    let score = 0; //starting score is 0
    let totalAnswered = 0; //total answers = 0 for now
    let countdown; //timer countdown goes here
    let highScore = 0; //highscore starts at 0

    const questions = questionBank[category]?.[difficulty] || []; //didn't wanna get errors, so empty array fallback

    //get previous high score
    function getPreviousHighScore() {
      const highScores = JSON.parse(localStorage.getItem('highScores')) || []; // get stored highscores
      const filtered = highScores.filter(s => s.category === category && s.difficulty === difficulty); // filtering the right category and difficulty scores
      if (filtered.length > 0) {
        highScore = Math.max(...filtered.map(s => s.score)); //max score for that category/difficulty
      }
      highScoreDisplay.textContent = `High Score: ${highScore}`; //update high score display
    }

    getPreviousHighScore(); //call it right away 

    if (questions.length === 0) { // no questions available?!?@?!???!
      questionEl.textContent = "No questions available for this combination."; // tell the user
    } else {
      startGame(); //start the game if questions are found
    }

    function startGame() {
      displayQuestion(); //display the first question
      startTimer(timerDuration); //start the timer
    }

    function displayQuestion() {
      if (currentQuestionIndex >= questions.length) { //if all questions done
        showResult(); //show result sccreen
        return;
      }

      const currentQ = questions[currentQuestionIndex];
      questionEl.textContent = currentQ.question; //display the question
      optionsEl.innerHTML = ''; //clear out any old buttons

      currentQ.options.forEach(option => { //loop through the options
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = option;
        btn.onclick = () => checkAnswer(option, currentQ.answer); //check answer when clicked
        optionsEl.appendChild(btn); //add button to DOM
      });
    }

    function checkAnswer(selected, correct) {
      const optionButtons = document.querySelectorAll('.option-btn');

      optionButtons.forEach(button => { //check if the answer is right
        if (button.textContent === selected) {
          if (selected === correct) {
            button.style.backgroundColor = '#22c55e'; //right green
            score++; //increase score if right
          } else {
            button.style.backgroundColor = '#ef4444'; //wrong red boooooo
          }
        } else if (button.textContent === correct) {
          button.style.backgroundColor = '#22c55e'; //green if it's the correct option
        }
        button.disabled = true; //disable all buttons after answering
      });

      totalAnswered++; //update number of answered questions
      scoreTallyEl.textContent = `Correct: ${score} / Total: ${totalAnswered}`; //update score display

      //update high score live if surpassed
      if (score > highScore) {
        highScore = score;
        highScoreDisplay.textContent = `High Score: ${highScore}`; //show new high score if needed
      }

      setTimeout(() => { //wait 1 second before showing next question
        currentQuestionIndex++;
        displayQuestion();
      }, 1000);
    }

    function startTimer(seconds) {
      timerEl.textContent = `Time Left: ${seconds}s`; //show initial time left

      countdown = setInterval(() => {
        seconds--; //decrement time?? un increment time
        timerEl.textContent = `Time Left: ${seconds}s`; //update time display

        if (seconds <= 0) { // if time runs out
          clearInterval(countdown); // stop the countdown
          showResult(); // show the result screen
        }
      }, 1000);
    }

    function showResult() {
      clearInterval(countdown); //stop the timer
      questionContainer.style.display = 'none'; //hide questions
      resultEl.style.display = 'block'; //show result screen
      finalScoreEl.textContent = `${score} / ${questions.length}`; //final score display

      backToHomeBtn.onclick = () => {
        window.location.href = 'index.html'; //back to the home page
      };

      saveHighScore(); // save the high score once the game ends
    }

    function saveHighScore() {
      const highScores = JSON.parse(localStorage.getItem('highScores')) || []; //get all previous scores
      highScores.push({ score, category, difficulty }); //save current game score
      localStorage.setItem('highScores', JSON.stringify(highScores)); //store it
    }
  </script>
</body>
</html>
